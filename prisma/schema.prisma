// This is your Prisma schema file
// Learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Core User model
model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique
  emailVerified DateTime?
  image         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  role          UserRole  @default(USER)
  
  // Listings related fields
  listings         Listing[]        @relation("UserListings")
  savedListings    Listing[]        @relation("SavedListings")
  listingEnquiries ListingEnquiry[]
  
  // Verification status
  isVerified      Boolean   @default(false)
  verificationId  String?   // Stripe Identity verification ID
}

enum UserRole {
  USER
  AGENT
  ADMIN
}

// Main Listing model
model Listing {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Basic listing info
  title       String
  description String   @db.Text
  price       Decimal
  category    ListingCategory
  type        ListingType
  status      ListingStatus @default(ACTIVE)
  
  // Location details
  address     String?
  city        String
  state       String?
  country     String
  postcode    String
  latitude    Float?
  longitude   Float?
  
  // Media
  images      String[] // Array of image URLs
  videos      String[] // Array of video URLs
  
  // Specifications
  bedrooms    Int?
  bathrooms   Int?
  area        Float? // in square meters/feet
  features    String[] // Array of property features
  
  // Relations
  owner       User     @relation("UserListings", fields: [ownerId], references: [id])
  ownerId     String
  savedBy     User[]   @relation("SavedListings")
  enquiries   ListingEnquiry[]
  
  // For property listings
  propertyType PropertyType?
  tenure       TenureType?
  
  // For service listings
  serviceType  ServiceType?
  availability Json? // JSON object for availability schedule
  
  // For leisure listings
  leisureType  LeisureType?
  bookingType  BookingType?
  
  @@index([category])
  @@index([type])
  @@index([status])
  @@index([city])
}

enum ListingCategory {
  PROPERTY
  SERVICE
  LEISURE
}

enum ListingType {
  SALE
  RENT
  SERVICE
  EXPERIENCE
}

enum ListingStatus {
  DRAFT
  ACTIVE
  PENDING
  SOLD
  RENTED
  EXPIRED
  INACTIVE
}

enum PropertyType {
  HOUSE
  APARTMENT
  COMMERCIAL
  LAND
  INDUSTRIAL
}

enum TenureType {
  FREEHOLD
  LEASEHOLD
  SHARE_OF_FREEHOLD
}

enum ServiceType {
  TRADE
  PROFESSIONAL
  SPECIALIST
}

enum LeisureType {
  RENTAL
  EXPERIENCE
  VENUE
}

enum BookingType {
  HOURLY
  DAILY
  WEEKLY
  MONTHLY
  ONE_TIME
}

// Enquiry model for listing interactions
model ListingEnquiry {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Enquiry details
  message   String   @db.Text
  status    EnquiryStatus @default(PENDING)
  
  // Relations
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  listing   Listing  @relation(fields: [listingId], references: [id])
  listingId String
  
  @@index([status])
}

enum EnquiryStatus {
  PENDING
  RESPONDED
  CLOSED
  SPAM
}